<div class="dashboard-header">
  <h2>{{ mode === 'create' ? 'Tambah Mahasiswa' : 'Edit Mahasiswa' }}</h2>
  <p>{{ mode === 'create' ? 'Daftarkan mahasiswa baru ke dalam sistem' : 'Perbarui data pribadi mahasiswa' }}</p>
</div>

<section class="form-section">
  <form
    #studentForm="ngForm"
    (ngSubmit)="onSubmit(studentForm)"
    novalidate>

    <div class="form-group">
      <label for="nim" class="form-label">
        Nomor Induk Mahasiswa (NIM) <span class="required">*</span>
      </label>

      <div class="input-group">
        <input
          id="nim"
          type="text"
          class="form-input"
          name="nim"
          [(ngModel)]="formData.nim"
          required
          minlength="3"
          #nim="ngModel"
          [readonly]="mode === 'edit'"
          [class.error]="nim.invalid && (nim.dirty || studentForm.submitted)"
          placeholder="Contoh: 101202001">
      </div>

      <div class="error-message" *ngIf="nim.invalid && (nim.dirty || studentForm.submitted)">
        <span *ngIf="nim.errors?.['required']">NIM wajib diisi.</span>
        <span *ngIf="nim.errors?.['minlength']">Minimal 3 karakter.</span>
      </div>
    </div>

    <div class="form-group">
      <label for="name" class="form-label">
        Nama Lengkap <span class="required">*</span>
      </label>

      <div class="input-group">
        <input
          id="name"
          type="text"
          class="form-input"
          name="name"
          [(ngModel)]="formData.name"
          required
          minlength="3"
          #name="ngModel"
          [class.error]="name.invalid && (name.dirty || studentForm.submitted)"
          placeholder="Contoh: Budi Santoso">
      </div>

      <div class="error-message" *ngIf="name.invalid && (name.dirty || studentForm.submitted)">
        <span *ngIf="name.errors?.['required']">Nama wajib diisi.</span>
        <span *ngIf="name.errors?.['minlength']">Minimal 3 karakter.</span>
      </div>
    </div>

    <div class="form-group">
      <label for="major" class="form-label">
        Program Studi <span class="required">*</span>
      </label>

      <div class="input-group">
        <select
          id="major"
          class="form-input"
          name="major"
          [(ngModel)]="formData.major"
          required
          #major="ngModel"
          [class.error]="major.invalid && (major.dirty || studentForm.submitted)">

          <option [ngValue]="null" disabled>-- Pilih Program Studi --</option>

          <option *ngFor="let m of majors" [value]="m">{{ m }}</option>
        </select>
      </div>

      <div class="error-message" *ngIf="major.invalid && (major.dirty || studentForm.submitted)">
        <span *ngIf="major.errors?.['required']">Program studi wajib dipilih.</span>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="button"
        class="btn-secondary"
        (click)="mode === 'create' ? resetForm() : back()"
        [disabled]="isLoading">
        {{ mode === 'create' ? 'Bersihkan' : 'Batal' }}
      </button>

      <button
        type="submit"
        class="btn-add"
        [disabled]="studentForm.invalid || isLoading">
        {{ isLoading ? 'Menyimpan...' : (mode === 'create' ? 'Simpan Data' : 'Simpan Perubahan') }}
      </button>
    </div>

  </form>
</section>

<div class="toast-popup"
     [class.show]="toastState.show"
     [class.error]="toastState.type === 'error'">
  {{ toastState.message }}
</div>
