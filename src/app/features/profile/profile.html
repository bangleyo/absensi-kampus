<div class="dashboard-header">
  <h2>Pengaturan Akun</h2>
</div>

<section class="profile-section" aria-labelledby="profile-title">

  <form
    #passwordForm="ngForm"
    class="change-password-form"
    (ngSubmit)="onPasswordChange(passwordForm)"
    novalidate>

    <div class="form-group">
      <label for="currentPassword" class="form-label">
        Password Lama<span class="required">*</span>
      </label>

      <div class="input-group">
        <input
          id="currentPassword"
          [type]="showCurrentPassword ? 'text' : 'password'"
          class="form-input"
          name="currentPassword"
          [(ngModel)]="formData.currentPassword"
          required
          minlength="6"
          #currentPassword="ngModel"
          [class.error]="currentPassword.invalid && (currentPassword.dirty || passwordForm.submitted)"
          autocomplete="current-password"
          placeholder="Masukkan password lama">

        <button
          type="button"
          class="toggle-password"
          (click)="togglePasswordVisibility('current')"
          [attr.aria-label]="showCurrentPassword ? 'Sembunyikan' : 'Tampilkan'"
          tabindex="-1">
          <span aria-hidden="true">{{ showCurrentPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</span>
        </button>
      </div>

      @if (currentPassword.invalid && (currentPassword.dirty || passwordForm.submitted)) {
        <div class="error-message" role="alert">
          @if (currentPassword.errors?.['required']) { <span>Password lama wajib diisi</span> }
          @if (currentPassword.errors?.['minlength']) { <span>Minimal 6 karakter</span> }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="newPassword" class="form-label">
        Password Baru<span class="required">*</span>
      </label>

      <div class="input-group">
        <input
          id="newPassword"
          [type]="showNewPassword ? 'text' : 'password'"
          class="form-input"
          name="newPassword"
          [(ngModel)]="formData.newPassword"
          required
          minlength="8"
          pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}"
          #newPassword="ngModel"
          [class.error]="newPassword.invalid && (newPassword.dirty || passwordForm.submitted)"
          autocomplete="new-password"
          placeholder="Min. 8 karakter, Huruf Besar, Kecil & Angka">

        <button
          type="button"
          class="toggle-password"
          (click)="togglePasswordVisibility('new')"
          tabindex="-1">
          <span aria-hidden="true">{{ showNewPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</span>
        </button>
      </div>

      @if (newPassword.invalid && (newPassword.dirty || passwordForm.submitted)) {
        <div class="error-message" role="alert">
          @if (newPassword.errors?.['required']) { <span>Password baru wajib diisi</span> }
          @if (newPassword.errors?.['minlength']) { <span>Minimal 8 karakter</span> }
          @if (newPassword.errors?.['pattern']) { <span>Harus mengandung huruf besar, kecil, dan angka</span> }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="confirmPassword" class="form-label">
        Konfirmasi Password<span class="required">*</span>
      </label>

      <div class="input-group">
        <input
          id="confirmPassword"
          [type]="showConfirmPassword ? 'text' : 'password'"
          class="form-input"
          name="confirmPassword"
          [(ngModel)]="formData.confirmPassword"
          required
          [match]="formData.newPassword"
          #confirmPassword="ngModel"
          [class.error]="confirmPassword.invalid && (confirmPassword.dirty || passwordForm.submitted)"
          autocomplete="new-password"
          placeholder="Ulangi password baru">

        <button
          type="button"
          class="toggle-password"
          (click)="togglePasswordVisibility('confirm')"
          tabindex="-1">
          <span aria-hidden="true">{{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</span>
        </button>
      </div>

      @if (confirmPassword.invalid && (confirmPassword.dirty || passwordForm.submitted)) {
        <div class="error-message" role="alert">
          @if (confirmPassword.errors?.['required']) { <span>Konfirmasi wajib diisi</span> }
          @if (confirmPassword.errors?.['matching']) { <span>Password tidak cocok</span> }
        </div>
      }
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="resetForm()">
        Reset
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || status === 'loading'">
        {{ status === 'loading' ? 'Menyimpan...' : 'Simpan Perubahan' }}
      </button>
    </div>

    @if (statusMessage) {
      <div class="form-status"
           [class.success]="status === 'success'"
           [class.error]="status === 'error'"
           role="status">
        {{ statusMessage }}
      </div>
    }
  </form>
</section>
